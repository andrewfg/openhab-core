#!/bin/bash

# OpenHAB Auto Update Script for Linux / RedHat (YUM)

# Execute command: [EXEC_COMMAND]

# newline for clean log output
echo

# ignore SIGTERM so this script isn't killed when OpenHAB shuts down
trap "" 15

# stop OpenHAB
systemctl stop openhab.service <<<"[PASSWORD]"

# create the YUM updater file
mkdir /etc/yum.repos.d 
cat > /etc/yum.repos.d/openhab.repo <<EOF
>[openHAB-[TARGET_TYPE]]
>name=openHAB [TARGET_TYPE]
>baseurl=https://openhab.jfrog.io/artifactory/openhab-linuxpkg-rpm/[TARGET_TYPE]
>gpgcheck=1
>gpgkey="https://openhab.jfrog.io/artifactory/api/gpg/key/public"
>enabled=1
>EOF

# update OpenHAB
sudo yum install openhab
sudo yum install openhab-addons

# start OpenHAB
systemctl start openhab.service <<<"[PASSWORD]"
