#!/bin/bash

# OpenHAB Auto Update Script for Linux / Debian / Apt

# Execute command: [EXEC_COMMAND]

# newline for clean log output
echo

# ignore SIGTERM so this script isn't killed when OpenHAB shuts down
trap "" 15

# stop OpenHAB
systemctl stop openhab.service <<<"[PASSWORD]"

# set repository
echo "deb https://openhab.jfrog.io/artifactory/openhab-linuxpkg [TARGET_TYPE] main" > /etc/apt/sources.list.d/openhab.list

# update OpenHAB
apt-get update
openhabVersion="$(apt-cache madison openhab | head -n 1 | cut -d'|' -f2 | xargs)"
apt-get install --allow-downgrades --yes --option Dpkg::Options::="--force-confnew" "openhab=${openhabVersion}" "openhab-addons=${openhabVersion}"

# start OpenHAB
systemctl start openhab.service <<<"[PASSWORD]"
